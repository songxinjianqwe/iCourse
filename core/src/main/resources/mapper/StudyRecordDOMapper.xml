<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinjinsong.icourse.core.dao.course.StudyRecordDOMapper">
    <resultMap id="BaseResultMap" type="com.sinjinsong.icourse.core.domain.entity.course.StudyRecordDO">
        <id column="id" property="id"></id>
        <result column="normal_score" property="normalScore"></result>
        <result column="total_score" property="totalScore"></result>
        <result column="status" property="status"
                javaType="com.sinjinsong.icourse.core.enumeration.course.StudyStatus"></result>
        <association column="class_id" property="classDO"
                     select="com.sinjinsong.icourse.core.dao.course.ClassDOMapper.selectByPrimaryKey"></association>
        <association column="student_id" property="student"
                     select="com.sinjinsong.icourse.core.dao.student.StudentDOMapper.selectByPrimaryKey"></association>
        <association column="order_id" property="order"
                     select="com.sinjinsong.icourse.core.dao.order.OrderDOMapper.selectByPrimaryKey"></association>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, class_id, student_id, normal_score, total_score, status,order_id
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from study_record
        where id = #{id,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from study_record
        where id = #{id,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.sinjinsong.icourse.core.domain.entity.course.StudyRecordDO" useGeneratedKeys="true" keyProperty="id">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into study_record (id, class_id, student_id,
        normal_score, total_score, status,order_id
        )
        values (#{id,jdbcType=BIGINT}, #{classDO.id,jdbcType=BIGINT}, #{student.id,jdbcType=BIGINT},
        #{normalScore,jdbcType=DOUBLE}, #{totalScore,jdbcType=DOUBLE}, #{status,jdbcType=SMALLINT},
        #{order.id,jdbcType=BIGINT}
        )
    </insert>
    <update id="updateByPrimaryKeySelective"
            parameterType="com.sinjinsong.icourse.core.domain.entity.course.StudyRecordDO">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update study_record
        <set>
            <if test="classDO != null">
                class_id = #{classDO.id,jdbcType=BIGINT},
            </if>
            <if test="student != null">
                student_id = #{student.id,jdbcType=BIGINT},
            </if>
            <if test="normalScore != null">
                normal_score = #{normalScore,jdbcType=DOUBLE},
            </if>
            <if test="totalScore != null">
                total_score = #{totalScore,jdbcType=DOUBLE},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=SMALLINT},
            </if>
            <if test="order != null">
                order_id = #{order.id,jdbcType=SMALLINT},
            </if>
        </set>
        where id = #{id,jdbcType=BIGINT}
    </update>

    <select id="findAllByStudentId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from study_record
        where student_id = #{studentId,jdbcType=BIGINT}
        order by id desc
    </select>

    <select id="findAllByClassId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from study_record
        where class_id = #{classId,jdbcType=BIGINT}
        order by id desc
    </select>
    
    <select id="findByOrderId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from study_record
        where order_id = #{orderId,jdbcType=BIGINT}
    </select>
    
</mapper>